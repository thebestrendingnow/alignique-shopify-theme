{% comment %}
  Voice Shopping Assistant Snippet
  
  Installation:
  1. Save this file as: snippets/voice-assistant.liquid
  2. In your theme.liquid, add before </body>:
     {% render 'voice-assistant' %}
  3. Save and done!
{% endcomment %}

<style>
.vsa-chat-button{position:fixed;bottom:24px;right:24px;width:64px;height:64px;border-radius:50%;background:linear-gradient(135deg,#7c3aed 0%,#8b5cf6 50%,#6366f1 100%);box-shadow:0 20px 50px rgba(124,58,237,0.4);border:none;cursor:pointer;z-index:999999;display:flex;align-items:center;justify-content:center;transition:all 0.3s cubic-bezier(0.4,0,0.2,1)}.vsa-chat-button:hover{transform:scale(1.1) rotate(5deg);box-shadow:0 25px 60px rgba(124,58,237,0.6)}.vsa-sparkle{position:absolute;top:-4px;right:-4px;width:20px;height:20px;background:#fbbf24;border-radius:50%;animation:vsa-pulse 2s infinite}@keyframes vsa-pulse{0%,100%{transform:scale(1);opacity:1}50%{transform:scale(1.2);opacity:0.8}}.vsa-widget{position:fixed;bottom:100px;right:24px;width:420px;max-width:calc(100vw - 48px);height:620px;max-height:calc(100vh - 140px);background:linear-gradient(to bottom,#ffffff,#faf5ff);border-radius:20px;box-shadow:0 25px 50px rgba(0,0,0,0.25);z-index:999998;display:none;flex-direction:column;overflow:hidden;animation:vsa-slideUp 0.4s cubic-bezier(0.4,0,0.2,1)}.vsa-widget.vsa-open{display:flex}@keyframes vsa-slideUp{from{opacity:0;transform:translateY(30px) scale(0.95)}to{opacity:1;transform:translateY(0) scale(1)}}.vsa-header{background:linear-gradient(135deg,#7c3aed 0%,#8b5cf6 50%,#6366f1 100%);padding:20px;color:white;position:relative;overflow:hidden}.vsa-header::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:radial-gradient(circle at 30% 50%,rgba(255,255,255,0.1) 0%,transparent 50%)}.vsa-header-content{position:relative;z-index:1;display:flex;justify-content:space-between;align-items:center}.vsa-avatar{width:48px;height:48px;background:rgba(255,255,255,0.2);backdrop-filter:blur(10px);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:24px;border:2px solid rgba(255,255,255,0.3)}.vsa-status{width:10px;height:10px;background:#4ade80;border-radius:50%;display:inline-block;margin-right:6px;animation:vsa-pulse 2s infinite}.vsa-close-btn{background:rgba(255,255,255,0.2);border:none;color:white;width:36px;height:36px;border-radius:50%;cursor:pointer;font-size:20px;transition:all 0.2s}.vsa-close-btn:hover{background:rgba(255,255,255,0.3);transform:rotate(90deg)}.vsa-messages{flex:1;overflow-y:auto;padding:20px;display:flex;flex-direction:column;gap:16px}.vsa-message{display:flex;gap:12px;animation:vsa-slideIn 0.3s ease-out}@keyframes vsa-slideIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.vsa-message.vsa-user{flex-direction:row-reverse}.vsa-message-avatar{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;flex-shrink:0;font-size:18px}.vsa-message.vsa-bot .vsa-message-avatar{background:linear-gradient(135deg,#7c3aed,#6366f1);color:white}.vsa-message.vsa-user .vsa-message-avatar{background:linear-gradient(135deg,#3b82f6,#2563eb);color:white}.vsa-message-content{max-width:75%;padding:14px 18px;border-radius:18px;font-size:15px;line-height:1.5}.vsa-message.vsa-bot .vsa-message-content{background:white;color:#1f2937;border-radius:18px 18px 18px 4px;box-shadow:0 2px 8px rgba(0,0,0,0.08);border:1px solid rgba(124,58,237,0.1)}.vsa-message.vsa-user .vsa-message-content{background:linear-gradient(135deg,#3b82f6,#2563eb);color:white;border-radius:18px 18px 4px 18px}.vsa-typing{display:flex;gap:4px;padding:16px}.vsa-typing-dot{width:8px;height:8px;background:#7c3aed;border-radius:50%;animation:vsa-typing 1.4s infinite}.vsa-typing-dot:nth-child(2){animation-delay:0.2s}.vsa-typing-dot:nth-child(3){animation-delay:0.4s}@keyframes vsa-typing{0%,60%,100%{transform:translateY(0)}30%{transform:translateY(-10px)}}.vsa-listening{background:linear-gradient(135deg,#dbeafe,#ede9fe);padding:12px 20px;text-align:center;border-top:1px solid rgba(124,58,237,0.1)}.vsa-listening-text{color:#7c3aed;font-weight:600;font-size:14px;display:flex;align-items:center;justify-content:center;gap:8px}.vsa-wave{width:3px;height:20px;background:linear-gradient(to top,#7c3aed,#6366f1);border-radius:2px;display:inline-block;animation:vsa-wave 1s infinite ease-in-out}.vsa-wave:nth-child(2){animation-delay:0.1s}.vsa-wave:nth-child(3){animation-delay:0.2s}.vsa-wave:nth-child(4){animation-delay:0.3s}.vsa-wave:nth-child(5){animation-delay:0.4s}@keyframes vsa-wave{0%,100%{height:10px}50%{height:28px}}.vsa-input-area{padding:20px;background:white;border-top:1px solid rgba(0,0,0,0.05)}.vsa-input-row{display:flex;gap:10px;margin-bottom:12px}.vsa-input{flex:1;padding:14px 20px;border:2px solid #e5e7eb;border-radius:25px;font-size:15px;outline:none;transition:all 0.2s}.vsa-input:focus{border-color:#7c3aed;box-shadow:0 0 0 4px rgba(124,58,237,0.1)}.vsa-btn{width:50px;height:50px;border-radius:50%;border:none;cursor:pointer;font-size:22px;transition:all 0.2s;display:flex;align-items:center;justify-content:center}.vsa-mic-btn{background:linear-gradient(135deg,#3b82f6,#2563eb);color:white}.vsa-mic-btn:hover{transform:scale(1.05);box-shadow:0 4px 12px rgba(59,130,246,0.4)}.vsa-mic-btn.vsa-recording{background:linear-gradient(135deg,#ef4444,#dc2626);animation:vsa-pulse 1.5s infinite}.vsa-send-btn{background:linear-gradient(135deg,#7c3aed,#6366f1);color:white}.vsa-send-btn:hover{transform:scale(1.05) rotate(5deg);box-shadow:0 4px 12px rgba(124,58,237,0.4)}.vsa-footer{display:flex;justify-content:space-between;align-items:center;font-size:12px;color:#6b7280}.vsa-checkbox-label{display:flex;align-items:center;gap:6px;cursor:pointer}.vsa-checkbox{width:18px;height:18px;cursor:pointer;accent-color:#7c3aed}@media (max-width:640px){.vsa-widget{width:calc(100vw - 32px);height:calc(100vh - 120px);right:16px}.vsa-chat-button{right:16px;bottom:16px}}
</style>

<div id="vsa-root">
  <button class="vsa-chat-button" id="vsa-toggle">
    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
    <span class="vsa-sparkle"></span>
  </button>
  <div class="vsa-widget" id="vsa-widget">
    <div class="vsa-header">
      <div class="vsa-header-content">
        <div style="display:flex;align-items:center;gap:14px">
          <div class="vsa-avatar">‚ú®</div>
          <div>
            <div style="font-weight:700;font-size:18px;margin-bottom:2px">Voice Assistant</div>
            <div style="font-size:13px;opacity:0.95"><span class="vsa-status"></span>Online & Ready</div>
          </div>
        </div>
        <button class="vsa-close-btn" id="vsa-close">√ó</button>
      </div>
    </div>
    <div class="vsa-messages" id="vsa-messages"></div>
    <div id="vsa-listening" class="vsa-listening" style="display:none">
      <div class="vsa-listening-text">Listening...<div><span class="vsa-wave"></span><span class="vsa-wave"></span><span class="vsa-wave"></span><span class="vsa-wave"></span><span class="vsa-wave"></span></div></div>
    </div>
    <div class="vsa-input-area">
      <div class="vsa-input-row">
        <input type="text" class="vsa-input" id="vsa-input" placeholder="Type or click mic to speak..."/>
        <button class="vsa-btn vsa-mic-btn" id="vsa-mic">üé§</button>
        <button class="vsa-btn vsa-send-btn" id="vsa-send"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg></button>
      </div>
      <div class="vsa-footer">
        <span>üí° Try: "Show me products"</span>
        <label class="vsa-checkbox-label"><input type="checkbox" id="vsa-autospeak" class="vsa-checkbox" checked/><span>Auto-speak</span></label>
      </div>
    </div>
  </div>
</div>

<script>
!function(){"use strict";const e={isOpen:!1,isListening:!1,autoSpeak:!0,recognition:null,synthesis:window.speechSynthesis,init(){this.elements={toggle:document.getElementById("vsa-toggle"),widget:document.getElementById("vsa-widget"),close:document.getElementById("vsa-close"),messages:document.getElementById("vsa-messages"),input:document.getElementById("vsa-input"),mic:document.getElementById("vsa-mic"),send:document.getElementById("vsa-send"),autospeak:document.getElementById("vsa-autospeak"),listening:document.getElementById("vsa-listening")},this.bindEvents(),this.initSpeech(),this.addWelcomeMessage()},bindEvents(){this.elements.toggle.addEventListener("click",(()=>this.toggleWidget())),this.elements.close.addEventListener("click",(()=>this.toggleWidget())),this.elements.send.addEventListener("click",(()=>this.sendMessage())),this.elements.mic.addEventListener("click",(()=>this.toggleVoice())),this.elements.autospeak.addEventListener("change",(e=>{this.autoSpeak=e.target.checked})),this.elements.input.addEventListener("keypress",(e=>{"Enter"===e.key&&this.sendMessage()}))},initSpeech(){if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const e=window.SpeechRecognition||window.webkitSpeechRecognition;this.recognition=new e,this.recognition.continuous=!1,this.recognition.interimResults=!0,this.recognition.lang="en-US",this.recognition.onresult=e=>{const t=Array.from(e.results).map((e=>e[0].transcript)).join("");this.elements.input.value=t,e.results[0].isFinal&&this.sendMessage()},this.recognition.onend=()=>{this.stopListening()}}},toggleWidget(){this.isOpen=!this.isOpen,this.elements.widget.classList.toggle("vsa-open",this.isOpen),this.isOpen&&this.elements.input.focus()},toggleVoice(){this.recognition?this.isListening?this.recognition.stop():(this.recognition.start(),this.startListening()):alert("Voice input not supported in your browser. Please use Chrome or Safari.")},startListening(){this.isListening=!0,this.elements.mic.classList.add("vsa-recording"),this.elements.mic.textContent="üõë",this.elements.listening.style.display="block"},stopListening(){this.isListening=!1,this.elements.mic.classList.remove("vsa-recording"),this.elements.mic.textContent="üé§",this.elements.listening.style.display="none"},addWelcomeMessage(){this.addMessage("üëã Hi! I'm your voice-enabled shopping assistant. You can type or speak to me!","bot")},addMessage(e,t){const s=document.createElement("div");s.className=`vsa-message vsa-${t}`,s.innerHTML=`<div class="vsa-message-avatar">${"user"===t?"üë§":"‚ú®"}</div><div class="vsa-message-content">${e}</div>`,this.elements.messages.appendChild(s),this.elements.messages.scrollTop=this.elements.messages.scrollHeight},sendMessage(){const e=this.elements.input.value.trim();e&&(this.addMessage(e,"user"),this.elements.input.value="",this.showTyping(),setTimeout((()=>{this.hideTyping();const t=this.getResponse(e);this.addMessage(t,"bot"),this.autoSpeak&&this.speak(t)}),1e3))},getResponse(e){const t=e.toLowerCase();return t.includes("product")||t.includes("show")||t.includes("find")?"üõçÔ∏è I found some great products for you! Check out our latest collection. Would you like to see bestsellers or new arrivals?":t.includes("ship")||t.includes("delivery")?"üöö We offer free shipping on orders over $50! Standard delivery takes 3-5 business days. Express shipping available.":t.includes("return")||t.includes("refund")?"‚Ü©Ô∏è We have a 30-day return policy. If you're not satisfied, you can return any item for a full refund!":t.includes("price")||t.includes("cost")?"üí∞ Our products range from $10 to $200. What type of product are you interested in? I can give you specific pricing.":t.includes("help")||t.includes("support")?"üíÅ‚Äç‚ôÄÔ∏è I'm here to help! Ask me about products, orders, shipping, returns, or anything else. What would you like to know?":"Thanks for your message! I'm your AI shopping assistant. Ask me about products, shipping, orders, or say \"help\" for more options. ü§ñ"},showTyping(){const e=document.createElement("div");e.id="vsa-typing",e.className="vsa-message vsa-bot",e.innerHTML='<div class="vsa-message-avatar">‚ú®</div><div class="vsa-message-content"><div class="vsa-typing"><div class="vsa-typing-dot"></div><div class="vsa-typing-dot"></div><div class="vsa-typing-dot"></div></div></div>',this.elements.messages.appendChild(e),this.elements.messages.scrollTop=this.elements.messages.scrollHeight},hideTyping(){const e=document.getElementById("vsa-typing");e&&e.remove()},speak(e){if(!this.synthesis)return;this.synthesis.cancel();const t=new SpeechSynthesisUtterance(e);t.rate=1,t.pitch=1,t.lang="en-US",this.synthesis.speak(t)}};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",(()=>e.init())):e.init()}();
</script>
